---
title: "Lab4"
author: "Zhang Zhixian"
date: "2023-07-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
*Agenda*: Writing functions to automate repetitive tasks; fitting statistical models.

The **gamma** distributions are a family of probability distributions defined by the density functions,
$$
f(x)=\frac{x^{a-1}e^{\frac{-x}{s}}}{s^a\Gamma(a)}
$$
where the gamma function $\Gamma(a)=\int_{0}^{\infty}u^{a-1}e^{-u}du$ is chosen so that the total probability of all non-negative $x$ is 1. The parameter $a$ is called the **shape**, and $s$ is the **scale**. When a = 1, this becomes the exponential distributions we saw in the first lab. The gamma probability density function is called **dgamma()** in R. You can prove (as a calculus exercise) that the expectation value of this distribution is as, and the variance $as^2$. If the mean and variance are known, $\mu$ and $\sigma^2$, then we can solve for the parameters,

$$
a=\frac{a^2s^2}{as^2}=\frac{\mu^2}{\sigma^2}
\\
s=\frac{as^2}{as}=\frac{\sigma^2}{\mu}
$$
In this lab, you will fit a gamma distribution to data, and estimate the uncertainty in the fit. Our data today are measurements of the weight of the hearts of 144 cats.

# Part 1
For the first part, we fit the gamma distribution to data.

1. The data is contained in a data frame called cats, in the R package MASS. (This package is part of the standard R installation.) This records the sex of each cat, its weight in kilograms, and the weight of its
heart in grams. Load the data as follows:
```{r}
library(MASS)
cats
summary(cats)

```


2. Plot a histogram of these weights using the probability=TRUE option. Add a vertical line with your calculated mean using abline(v=yourmeanvaluehere). Does this calculated mean look correct?
```{r}
par(mfrow=c(1,2)) # put two figures in one rows and two columns
hist(cats$Bwt,probability = TRUE,main='Body Weight')
abline(v=2.724)
hist(cats$Hwt,probability = TRUE,main='Heart Weight')
abline(v=10.63 )
```
```
Both of two means look correct.
```

3. Define two variables, fake.mean <- 10 and fake.var <- 8 . Write an expression for $a$ using these placeholder values. Does it equal what you expected given the solutions above? Once it does, write another such expression for $s$ and confirm.
# 啥意思？？
```{r}
fake.mean <- 10
fake.var <- 8
a <- fake.mean^2 / fake.var
s <- fake.var / fake.mean
cat(a,s)
```

4. Calculate the mean, standard deviation, and variance of the heart weights using R’s existing functions for these tasks. Plug the mean and variance of the cats’ hearts into your formulas from the previous question and get estimates of a and s . What are they? Do not report them to more significant digits than is reasonable.
```{r}
Hwt_mean <- mean(cats$Hwt)
Hwt_var <- var(cats$Hwt)
a <- Hwt_mean^2/Hwt_var
s <- Hwt_var/Hwt_mean
cat(a,s)

```
```
They are the parameters of the Gamma distribution which fits the data from cats. 
```

5. Write a function, cat.stats() , which takes as input a vector of numbers and returns the mean and variances of these cat hearts. (You can use the existing mean and variance functions within this function.) Confirm that you are returning the values from above.
```{r}
cat.stats <- function(x){
  mean <- mean(x)
  var <- var(x)
  return(c(mean,var))
}
cat.stats(cats$Hwt)
```


# Part 2
For the Second Part, we estimate the uncertainty in the fit.

6. Now, use your existing function as a template for a new function, gamma.cat() , that calculates the mean and variances and returns the estimate of a and s . What estimates does it give on the cats’ hearts
weight? Should it agree with your previous calculation?
```{r}
gamma.cat <- function(x){
  mean <- cat.stats(x)[1]
  var <- cat.stats(x)[2]
  a <- mean^2/var
  s <- var/mean
  return(c(a,s))
}
gamma.cat(cats$Hwt)
```
```
The results of the calculations are the same.
```

7. Estimate the a and s separately for all the male cats and all the female cats, using gamma.cat() . Give the commands you used and the results.
```{r}
male_cats <- cats[cats$Sex=='M',]
female_cats <- cats[cats$Sex=='F',]
gamma.cat(male_cats$Hwt)
gamma.cat(female_cats$Hwt)
```

8. Now, produce a histogram for the female cats. On top of this, add the shape of the gamma PDF using curve() with its first argument as dgamma() , the known PDF for the Gamma distribution. Is this distribution consistent with the empirical probability density of the histogram?
# 怎么画不出来？？？？？？？？？
```{r}
shape <- gamma.cat(female_cats$Hwt)[1]
scale <- gamma.cat(female_cats$Hwt)[2]
hist(female_cats$Hwt,probability=TRUE,main='Heart Weights of Female Cats')
curve(dgamma(x,shape,scale),add=TRUE)
```

9. Repeat the previous step for male cats. How do the distributions compare?
# 是这样的吗？？？
```{r}
shape <- gamma.cat(male_cats$Hwt)[1]
scale <- gamma.cat(male_cats$Hwt)[2]
hist(male_cats$Hwt,probability=TRUE,main='Heart Weights of Male Cats')
curve(dgamma(x,shape,scale),add=TRUE)
```











